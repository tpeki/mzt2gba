# mzt2gba

![mzt2gbapy](C:\Users\peki\デスクトップ\01 tempworks\mzt2gbapy.PNG)

MZ-700ソフトをGameboyAdvanceで実行できるようにする紅茶羊羹氏のエミュレータ MZ700GBA のためのGBAファイル作成フロントエンドです。

## 使い方

### 用意するもの

- MZ700GBA一式 - アーカイブ内の以下のファイルを利用します
  - MZTMERGE.EXE (変換ツール)
  - M7GBA_GP.BIN (エミュレータ本体)
- MZ-700用 IPL ROMイメージ
  - ファイル名はIPL名プルダウンにある名称に合わせてください。(1Z009A.ROM, NEWMON7.ROM，SP-1002.ROM, 1Z009B7.ROM)
  - NEWMON7.ROMはMZ NewMonitor(MZ700用)、1Z009B7.ROMは、MZ1500のIPLの先頭3バイトを 「C3 00 E8」から「C3 4A 00」に変更したものを想定しています。
  - が、ぶっちゃけIPL ROMの中身を見ているわけではないので、700用NEWMONITORだけでもいいかもしれません。
- MZ-700 ソフト - MZT形式(.MZTまたは.M12)、もしくはMZT形式のファイルをZIPしたもの
  - ZIPファイルの場合、ZIP内部に複数のMZTファイルがあれば、生成時にどれを使用するか選択するようになっています。
- 任天堂ヘッダファイル
  - GBAソフトの先頭192バイトに、任天堂ロゴデータを含むヘッダが入っています。これを取り出して、’NHEADER.BIN' という名前で保存してください。詳しくはAkatsuyki氏のGBA-DOCS-JAを参照
  - MZ700GBAのサンプルファイルを切り出すのが手っ取り早いです
  - チェックサムがあるので、まるっと移植してしまいます
- 用意してあるとよいもの： MZ-700エミュレータの実行環境
  - MZ700win (まるくん氏作(現在はAKD氏が配布)、派生 紅茶羊羹氏、Snail氏)、もしくはemuZ700(TAKEDA氏作)
  - スクリプト先頭に実行ファイルの場所を設定してください。なお、実行ファイルのあるフォルダをエミュレータの実行ディレクトリにします

## 使い方

1. 上の「Image」ボタンを押すとMZTファイルの選択ダイアログが出るので変換したいファイルを選択します。
2. Title欄にはわかりやすい名称(英数字16文字)を設定します。空欄にしておくとMZTファイル名の先頭を取ってきます
3. Core Settings欄のCore名、IPL名を指定します。表示順が気になる人はスクリプト先頭のCfg_core、Cfg_iplrom を変更してください。選択肢に出てくるファイル名はそれぞれ Cfg_core_opt、Cfg_ipl_opt に定義しています
4. Key Binds欄のキー割り当てをソフトに合わせて変更します。これもデフォルトを変更したい場合は適当にスクリプトの先頭にある Cfg_key_* の定義をいじってください。指定できる文字は Cfg_keys で定義されています
5. 右のPlayボタンを押下すると、プルダウンで指定したエミュレータが起動します。利用するキーの確認などを行ってください。なお、起動時にスクリプトのあるディレクトリに ’TEMP.MZT' という名前でMZTファイルのコピーを配置して、エミュレータの起動引数に設定しています。emuZ700だとCMTにセットされているはずなので、そのまま 'L' キー押下で実行されます。mz700winはCLIで読み込むファイルを指定できないので、OpenFileでTEMP.MZTを指定してください。
6. Show Config ボタンを押すと、下フィールドに変換用のconfigの中身を出力します。確認用。
7. Createボタン押下でGBA用ファイルを生成します。生成したファイルは、'MZ7_'+TITLE名+'.GBA' という名称になります。 N Headerのチェックを外すと任天堂ヘッダの合成をしません。誰得。
8. 終了する場合は、普通にウィンドウを閉じてください。アプリ上の終了ボタンはありません。

## 使用環境

Python 3.x + TkEasyGUI を 用いています。

PySimpleGUIが有償化して配布が面倒になった所に救いの手を差し伸べてくれた kujirahand氏に感謝を。

## ToDo

やらないと思うけどHuBASIC用のパッチを自動で当てる機能とか、BASICプログラムをBASICのMZTの後に付け足す機能とか。やっぱり面倒だからやらないと思うが

## 謝辞

あたりまえですが、元となった MZ700GBA を公開してくださった紅茶羊羹氏、そのもとになった MZ700Winを公開してくださった まるくん氏 に多大な感謝を

また、名機 MZ-700 を世に出した SHARP開発部の方々、MZ-700用ソフトを提供してくださった皆様にも感謝の意を表明させてください

###### 2024/9/29 TPK